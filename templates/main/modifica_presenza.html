{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Modifica Presenza</h2>
    <form action="{{ url_for('modifica_presenza', id=presenza.id_presenza) }}" method="post" class="needs-validation" novalidate>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="form-group mb-3">
            <label for="id_studente">Studente:</label>
            <select class="form-control" id="id_studente" name="id_studente" required>
                <option value="">Seleziona uno studente</option>
                {% for studente in studenti %}
                <option value="{{ studente.id_studente }}" {% if presenza.id_studente == studente.id_studente %}selected{% endif %}>
                    {{ studente.cognome }} {{ studente.nome }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group mb-3">
            <label for="id_lezione">Lezione:</label>
            <select class="form-control" id="id_lezione" name="id_lezione" required>
                <option value="">Seleziona una lezione</option>
                {% for lezione in lezioni %}
                <option value="{{ lezione.id_lezione }}" {% if presenza.id_lezione == lezione.id_lezione %}selected{% endif %}>
                    {{ lezione.nome_lezione }} ({{ lezione.data.strftime('%d/%m/%Y') }})
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" id="presente" name="presente" value="1" 
                   {% if presenza.presente %}checked{% endif %}>
            <label class="form-check-label" for="presente">Presente</label>
        </div>

        <div class="form-group mb-3">
            <label for="ore">Ore di presenza:</label>
            <input type="number" class="form-control" id="ore" name="ore" step="0.5" min="0" 
                   value="{{ presenza.ore }}" required>
        </div>

        <div class="form-group mb-3">
            <label for="cfu">CFU:</label>
            <input type="number" class="form-control" id="cfu" name="cfu" step="0.5" min="0" 
                   value="{{ presenza.cfu }}">
        </div>

        <div class="form-group mb-3">
            <label for="note">Note:</label>
            <textarea class="form-control" id="note" name="note" rows="3">{{ presenza.note }}</textarea>
        </div>

        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Salva Modifiche</button>
            <a href="{{ url_for('lista_presenze') }}" class="btn btn-secondary">Annulla</a>
        </div>
    </form>
</div>

<script>
document.getElementById('ore').addEventListener('change', function() {
    // Calcola automaticamente i CFU (1 CFU ogni 6 ore)
    const ore = parseFloat(this.value) || 0;
    const cfu = Math.round((ore / 6) * 2) / 2; // Arrotonda a 0.5 pi√π vicino
    document.getElementById('cfu').value = cfu;
});
</script>
{% endblock %}